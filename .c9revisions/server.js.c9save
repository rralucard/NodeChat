{"ts":1381975250087,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"var http = require('http');\r\nvar fs = require('fs');\r\nvar path = require('path');\r\nvar mime = require('mime');\r\nvar cache = {};\r\nfunction send404(response) {\r\n    response.writeHead(404, {'Content-Type': 'text/plain'});\r\n    response.write('Error 404: resource not found.');\r\n    response.end();\r\n}\r\n\r\n\r\nfunction sendFile(response, filePath, fileContents) {\r\n    response.writeHead(\r\n        200,\r\n        {\"content-type\": mime.lookup(path.basename(filePath))}\r\n    );\r\n    response.end(fileContents);\r\n}\r\n\r\nfunction serveStatic(response, cache, absPath) {\r\n    if (cache[absPath]) {\r\n        sendFile(response, absPath, cache[absPath]);\r\n    } else {\r\n        fs.exists(absPath, function(exists) {\r\n            if (exists) {\r\n                fs.readFile(absPath, function(err, data) {\r\n                    if (err) {\r\n                        send404(response);\r\n                    } else {\r\n                        cache[absPath] = data;\r\n                        sendFile(response, absPath, data);\r\n                    }\r\n                });\r\n            } else {\r\n                send404(response);\r\n            }\r\n        });\r\n    }\r\n}\r\n\r\nvar server = http.createServer(function(request, response) {\r\n    var filePath = false;\r\n    if (request.url == '/') {\r\n        filePath = 'public/index.html';\r\n    } else {\r\n        filePath = 'public' + request.url;\r\n    }\r\n    var absPath = './' + filePath;\r\n    serveStatic(response, cache, absPath);\r\n});\r\n\r\n\r\nserver.listen(process.env.PORT, process.env.IP, function() {\r\n    console.log(\"Server listening on port 3000.\");\r\n});\r\n\r\nvar chatServer = require('./lib/chat_server');\r\nchatServer.listen(server);"]],"start1":0,"start2":0,"length1":0,"length2":1653}]],"length":1653}
