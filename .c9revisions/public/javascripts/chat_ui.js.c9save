{"ts":1381975275974,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"\r\nfunction divEscapedContentElement(message) {\r\n    return $('<div></div>').text(message);\r\n}\r\nfunction divSystemContentElement(message) {\r\n    return $('<div></div>').html('<i>' + message + '</i>');\r\n}\r\n\r\n\r\nfunction processUserInput(chatApp, socket) {\r\n    var message = $('#send-message').val();\r\n    var systemMessage;\r\n    if (message.charAt(0) == '/') {\r\n        systemMessage = chatApp.processCommand(message);\r\n        if (systemMessage) {\r\n            $('#messages').append(divSystemContentElement(systemMessage));\r\n        }\r\n    } else {\r\n        chatApp.sendMessage($('#room').text(), message);\r\n        $('#messages').append(divEscapedContentElement(message));\r\n        $('#messages').scrollTop($('#messages').prop('scrollHeight'));\r\n    }\r\n    $('#send-message').val('');\r\n}\r\n\r\nvar socket = io.connect();\r\n\r\n\r\n\r\n$(document).ready(function() {\r\n    alert();\r\n    var chatApp = new Chat(socket);\r\n    socket.on('nameResult', function(result) {\r\n        var message;\r\n        if (result.success) {\r\n            message = 'You are now known as ' + result.name + '.';\r\n        } else {\r\n            message = result.message;\r\n        }\r\n        $('#messages').append(divSystemContentElement(message));\r\n    });\r\n    socket.on('joinResult', function(result) {\r\n        $('#room').text(result.room);\r\n        $('#messages').append(divSystemContentElement('Room changed.'));\r\n    });\r\n    socket.on('message', function (message) {\r\n        var newElement = $('<div></div>').text(message.text);\r\n        $('#messages').append(newElement);\r\n    });\r\n    socket.on('rooms', function(rooms) {\r\n        $('#room-list').empty();\r\n        for(var room in rooms) {\r\n            room = room.substring(1, room.length);\r\n            if (room != '') {\r\n                $('#room-list').append(divEscapedContentElement(room));\r\n            }\r\n        }\r\n        $('#room-list div').click(function() {\r\n            chatApp.processCommand('/join ' + $(this).text());\r\n            $('#send-message').focus();\r\n        });\r\n    });\r\n    setInterval(function() {\r\n        socket.emit('rooms');\r\n    }, 1000);\r\n    $('#send-message').focus();\r\n    $('#send-form').submit(function() {\r\n        processUserInput(chatApp, socket);\r\n        return false;\r\n    });\r\n});\r\n\r\n"]],"start1":0,"start2":0,"length1":0,"length2":2253}]],"length":2253}
{"contributors":[],"silentsave":false,"ts":1381975341315,"patch":[[{"diffs":[[0," {\r\n"],[-1,"    alert();"],[0,"\r\n  "]],"start1":853,"start2":853,"length1":20,"length2":8}]],"length":2241,"saved":false}
